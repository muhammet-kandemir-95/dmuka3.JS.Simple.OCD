<html>

<head>
	<title>dmuka3.JS.Simple.OCD</title>

	<link rel="stylesheet" href="css/main.css">
</head>

<body>
	<div id="students-parent">
		<div class="class-name">
			<input name="Name" placeholder="Class Name" type="text" value="">
		</div>
		<div class="add-student">
			<button onclick="$student.students.add();">Add a Student</button>
		</div>
		<div class="students">
			<div ocd-clone class="student">
				<div>
					<span>Student Name : </span> <input name="Name" placeholder="Student Name" type="text">
				</div>
				<div>
					<span>Student Surname : </span> <input name="Surname" placeholder="Student Surname" type="text">
				</div>
				<div>
					<button class="student-opacity">Add Opacity</button>
				</div>
				<div>
					<span>Addresses</span>
					<button onclick="this.ocd.$parentOcdItem.addresses.add();">Add an Address</button>
				</div>
				<div class="addresses">
					<input ocd-clone name="Description"
						placeholder="Student Address (Press backspace to delete while is empty)" type="text">
				</div>
				<div class="remove-student">
					<button onclick="this.ocd.$parentOcdItem.remove();">Remove Student</button>
				</div>
			</div>
		</div>
	</div>

	<hr>

	<pre></pre>

	<script src="js/dmuka3.JS.Simple.OCD.js"></script>
	<script>
		var $student = $d.ocd({
			query: '#students-parent',
			obj: true,
			sub: [{
				query: '>.class-name',
				alias: 'class',
				obj: true,
				sub: [{
					query: '>input[name="Name"]',
					alias: 'name',
					obj: true
				}]
			}, {
				parentQuery: '>.students',
				query: '>.student',
				alias: 'students',
				data: {
					enableOpacity: {
						jobject: true,
						get: function (el) {
							return el.ocd.is('.active-opacity');
						},
						set: function (el, value) {
							if (value === true) {
								el.ocd.addClass('active-opacity');
								el.$ocdItem.opacityButton.el.ocd.text('Remove Opacity');
							} else {
								el.ocd.removeClass('active-opacity');
								el.$ocdItem.opacityButton.el.ocd.text('Add Opacity');
							}
						}
					}
				},
				sub: [{
					query: '>div>*[name="Name"]',
					alias: 'name',
					obj: true
				}, {
					query: '>div>*[name="Surname"]',
					alias: 'surname',
					obj: true
				}, {
					jobject: false,
					query: '>div>.student-opacity',
					alias: 'opacityButton',
					obj: true,
					oninit: function ($ocdItem) {
						$ocdItem.el.ocd.on('click', function (e) {
							$ocdItem.$parent.enableOpacity = $ocdItem.$parent.enableOpacity === false;
						});
					}
				}, {
					parentQuery: '>.addresses',
					query: '>input[name="Description"]',
					alias: 'addresses',
					oninit: function ($ocdItem) {
						$ocdItem.el.ocd.on('keydown', function (e) {
							if (e.keyCode === 8 && this.value === '') {
								$ocdItem.remove();
							}
						});
					}
				}]
			}]
		});

		if (localStorage.getItem('students') !== null && localStorage.getItem('students') !== undefined) {
			$student.set(JSON.parse(localStorage.getItem('students')));
		}

		setInterval(() => {
			if (JSON.stringify($student.jobject, null, 4) !== $ocdq.findFirst('pre').ocd.html()) {
				$ocdq.findFirst('pre').ocd.html(JSON.stringify($student.jobject, null, 4));
				localStorage.setItem('students', JSON.stringify($student.jobject, null, 4));
			}
		}, 1);
	</script>
</body>

</html>