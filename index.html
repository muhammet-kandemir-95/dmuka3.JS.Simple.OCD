<html>

<head>
	<title>dmuka3.JS.Simple.OCD</title>

	<link rel="stylesheet" href="css/main.css">
</head>

<body>
	<div id="students-parent">
		<div class="class-name">
			<input name="Name" placeholder="Class Name" type="text" value="">
		</div>
		<div class="add-student">
			<button onclick="addStudent();">Add a Student</button>
		</div>
		<div class="students">
			<div ocd-clone class="student">
				<div>
					<span>Student Name : </span> <input name="Name" placeholder="Student Name" type="text">
				</div>
				<div>
					<span>Student Surname : </span> <input name="Surname" placeholder="Student Surname" type="text">
				</div>
				<div>
					<span>Addresses</span>
					<button onclick="addAddress(this.ocd.$parentOcdItem)">Add an Address</button>
				</div>
				<div class="addresses">
					<input ocd-clone name="Description" placeholder="Student Address" type="text">
				</div>
				<div class="remove-student">
					<button onclick="removeStudent(this.ocd.$parentOcdItem);">Remove Student</button>
				</div>
			</div>
		</div>
	</div>

	<hr>

	<pre></pre>

	<script src="js/dmuka3.JS.Simple.OCD.js"></script>
	<script>
		var $student = $d.ocd({
			query: '#students-parent',
			obj: true,
			sub: [{
				query: '>.class-name',
				alias: 'class',
				obj: true,
				sub: [{
					query: '>input[name="Name"]',
					alias: 'name',
					obj: true
				}]
			}, {
				parentQuery: '>.students',
				query: '>.student',
				alias: 'students',
				sub: [{
					query: '>div>*[name="Name"]',
					alias: 'name',
					obj: true
				}, {
					query: '>div>*[name="Surname"]',
					alias: 'surname',
					obj: true
				}, {
					parentQuery: '>.addresses',
					query: '>input[name="Description"]',
					alias: 'addresses',
					oninit: function ($ocdItem) {
						$ocdItem.el.ocd.on('keydown', function (e) {
							if (e.keyCode === 8 && this.value === '') {
								$ocdItem.remove();
							}
						});
					}
				}]
			}]
		});

		function addStudent() {
			$student.students.add();
		}

		function removeStudent($ocdItem) {
			$ocdItem.remove();
		}

		function addAddress($ocdItem) {
			$ocdItem.addresses.add();
		}

		setInterval(() => {
			if (JSON.stringify($student.jobject, null, 4) !== $ocdq.findFirst('pre').ocd.html()) {
				$ocdq.findFirst('pre').ocd.html(JSON.stringify($student.jobject, null, 4));
			}
		}, 1);
	</script>
</body>

</html>